# Get started with the DBRetina package

## 1. Installation

The DBRetina package is currently available on Pypi. You can install it using the following command:

```bash
pip install DBRetina
```

## 2. Commands

```bash
Usage: DBRetina [OPTIONS] COMMAND [ARGS]...

Options:
  --version    Show the version and exit.
  -q, --quiet
  --help       Show this message and exit.

Commands:
  index     Index hashes JSON file.
  pairwise  Generate pairwise TSV.
  query     Query DBRetina index.
  cluster   Clustering.
  export    Export DBRetina pairwise to multiple formats.
```

### 2.1 Indexing

#### 2.1.1 Input Files

The DBRetina's Index command is designed to generate an index of a gene association network. To utilize this command, you must provide an Association File and, optionally, a Names File.

**Association File**

The Association File is a two-column TSV (tab-separated values) file with an included header. The first column denotes groups, while the second column indicates the genes associated with each respective group. Each row signifies a single gene and its corresponding group.

**Example of an Association File:**

```tsv
Disease       Gene
Breast Cancer BRCA1
Breast Cancer BRCA2
Lung Cancer   EGFR
Lung Cancer   KRAS
```

**Names File (Optional)**

The Names File is another two-column TSV file, also including a header. The first column represents the group names from the Association File, and the second column specifies the corresponding supergroup or alias name. The Names File serves to allow the grouping of related groups under a broader category or supergroup. This file is optional; if not provided, the groups from the Association File will be treated as supergroups.

**Example of a Names File:**

```tsv
Group         Supergroup
Breast Cancer Cancer
Lung Cancer   Cancer
```

**Inverted Flag (Optional)**

An additional option flag, "inverted," is available to invert the index. When the "inverted" flag is used, querying a supergroup will return all associated genes, whereas, in the default index, querying a gene will return the associated supergroups.

**Illustration within the context of diseases:**

Consider an Association File containing a list of diseases and their associated genes. In this scenario, the diseases represent the groups, and each gene is assigned to a specific disease group. For instance, "Breast Cancer" could be a disease group, with genes related to breast cancer (e.g., BRCA1 and BRCA2) listed in the second column of the Association File.

If the Names File is not provided, the groups from the Association File will be treated as supergroups. For example, "Breast Cancer" would be considered a supergroup, and the associated genes (e.g., BRCA1 and BRCA2) would be listed directly under this supergroup.

When using the "inverted" flag, a user can query a supergroup, such as "Breast Cancer," and receive a list of all genes associated with that supergroup. In this example, the query result would include genes like BRCA1 and BRCA2. In contrast, the normal index allows a user to query a gene, such as BRCA1, and retrieve the supergroups associated with that gene (e.g., "Breast Cancer").

**Usage**

By providing the Association File, and if necessary, the Names File to the Index command, along with the optional "inverted" flag, you can generate an index of the gene association network that accommodates both disease groups and their corresponding supergroups, allowing for flexible querying of the network.

```bash
# Example command with Names File and "inverted" flag:
DBRetina index -a association.tsv -n names.tsv --inverted

# Example command without Names File:
DBRetina index -a association.tsv
```

#### 2.1.2 Output file

The output generated by the Index command consists of two JSON files (private and public) and a set of index files. These files are explained in detail below:

1. JSON Files: Private and Public
   - Private JSON file: This file contains supergroups and their related genes in text format. It is intended for internal use and reference, as it contains the actual gene names.
   - Public JSON file: This file also contains supergroups and their related genes, but the gene names are hashed. This hashed representation of genes is used in the index to protect the sensitive information. The public version is utilized during indexing, and the text representation of genes is not stored in the index.

    When the "inverted" flag is used, the roles of the private and public JSON files are reversed. The private file will contain genes and their related supergroups in text format, while the public file will have the gene names hashed.

2. Index Files
   The primary information required for index files is the index prefix, which is a common prefix present in all files generated during this step. The naming convention for the index files depends on whether the "inverted" flag is used:
   - Without "inverted" flag: If the indexing is performed without the "inverted" flag, the string "gene_to_groups" will be appended to the user-defined output prefix. For example, if the user specifies the output prefix as "test_idx", the final prefix for the index files will be "test_idx_gene_to_groups".
   - With "inverted" flag: If the "inverted" flag is used during indexing, the string "group_to_genes" will be appended to the user-defined output prefix. In this case, the final prefix for the index files will be "test_idx_group_to_genes".

  The generated index files consist of binary and text files that hold the index information. The binary files cannot be directly accessed or read, as they store the information in a non-human-readable format.

---

### 2.2 Pairwise

The Pairwise command in DBRetina is designed to perform pairwise comparisons between supergroups (or genes) based on their shared associations. This command requires the completion of the Index step and takes the full index prefix and the number of cores as input parameters.

**Input Requirements:**

- Full index prefix: This is the prefix generated during the Index step, which may include "_gene_to_groups" or "_group_to_genes" based on the usage of the "inverted" flag.

- Number of cores (optional): The number of processing cores to be used for parallel computation during the pairwise comparisons.

**Output:**

- The output of the Pairwise command is a TSV file that provides information about shared associations between every pair of supergroups (or genes) based on the "inverted" option, if used.
- Without "inverted" flag: The TSV file will contain the number of genes shared between every two supergroups.
- With "inverted" flag: The TSV file will contain the number of common supergroups associated with each pair of genes.

In addition to the shared associations, the TSV file will also include columns that convert this information into multiple distance metrics, such as minimum, average, maximum containment, and Jaccard.

In summary, the Pairwise command allows users to perform pairwise comparisons between supergroups (or genes) based on shared associations, providing valuable insights into the relationships between them. The resulting TSV file includes shared association counts and various distance metrics, enabling users to analyze the gene association network more comprehensively.

---

### 2.3 Query
<!-- Just like the pairwise command, the query command will need the full index prefix and the query command will detect whether the index has "gene_to_groups" or default, or "group_to_genes" or inverted based on its name. We will need a single column file with the genes or supergroups to query. So, if the index is not inverted, the command will expect a list of genes to query, and the output here will be two TSV files. The first one will be the gene name in the first column, and all associated supergroups in the second column separated by the pipe character. The second TSV file will have a first column of the supergroups and second column is the number of genes in that supergroup. (explain the vice versa situation if inverted was used). -->

The Query command in DBRetina is designed to retrieve information from the generated index based on a list of genes or supergroups. The command requires the full index prefix, and it will automatically detect the type of index based on its name, which may include "_gene_to_groups" or "_group_to_genes" appended to the prefix.

**Input Requirements:**

- Full index prefix: This is the prefix generated during the Index step, which may include "_gene_to_groups" or "_group_to_genes" based on the type of index created.
- Query file: A single-column file containing the list of genes or supergroups to query.

**Output:**

The output of the Query command consists of two TSV files, depending on the type of index created:

- With "_gene_to_groups" appended prefix: The command will expect a list of genes to query.
  - The first TSV file will have the gene name in the first column and all associated supergroups in the second column, separated by the pipe character (|).
  - The second TSV file will have the supergroup name in the first column and the number of genes associated with that supergroup in the second column.

- With "_group_to_genes" appended prefix: The command will expect a list of supergroups to query.
  - The first TSV file will have the supergroup name in the first column and all associated genes in the second column, separated by the pipe character (|).
  - The second TSV file will have the gene name in the first column and the number of supergroups associated with that gene in the second column.

